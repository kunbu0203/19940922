!async function(){const t=document.querySelector("#audio");$("[data-voice]").on("click",function(){"open"===$(this).data("voice")&&t.play(),a.play()});var s=Math.floor(2*Math.random())+1;$(".task-num, [data-target]").text(s);const y=s*$("[data-item]").length;let v=0;const a=gsap.timeline();a.pause(),a.to(".intro-item",{opacity:1,duration:.5,delay:.3,stagger:.1});const e=gsap.timeline();e.pause(),e.to(".card.-task",{opacity:1,duration:.5}).to(".card.-task .card-wrap",{opacity:1,scale:1,duration:1,ease:"back.out(2)"});const i=gsap.timeline({repeat:-1});i.pause(),i.to(".instruction-finger.-c",{x:0,y:0,duration:1}).to(".instruction-finger.-c",{scale:.8,duration:.2}).to(".instruction-finger.-c>div",{opacity:1,duration:.2},"<").to(".instruction-finger.-c",{scale:1,duration:.2}).to(".instruction-click>img",{scale:1.2,duration:.2},"<").to(".instruction-click>img",{scale:1.1,duration:.2}).to(".instruction-click>img",{opacity:0,duration:.4});const o=gsap.timeline({repeat:-1});o.pause(),o.to(".instruction-finger.-l",{x:0,y:0,duration:1}).to(".instruction-finger.-l",{y:"-20%",rotate:20,duration:.2}).to(".instruction-finger.-l>div",{opacity:1,rotate:-20,duration:.2},"<").to(".instruction-leaf>img",{y:"-60%",rotate:40,opacity:0,duration:.8});let n=30,c=null,w=!1;function I(){clearInterval(c),w=!1,c=null,function(){$("body").addClass("-isPopupOpen"),y===v?($('[data-popup="success"]').addClass("-show"),$("body").addClass("-success")):($('[data-popup="fail"]').addClass("-show"),$("body").addClass("-fail"),$("[data-share]").remove()),$("[data-found]").text(v),$("[data-notfound]").text(y-v);var t=v/y;let a="A",e="你是十六食穀收集達人 !";.76<=t&&(a="S",e="十六食穀之王非你莫屬"),t<=.4&&(a="B",e="還有好多食穀沒找到耶~再試試吧 !"),$(".score-level").addClass(`-${a}`).find("div").text(a),$(".score-desc").text(e)}()}const x=new PIXI.Application;await x.init({backgroundAlpha:0,resizeTo:document.querySelector("#canvas-container"),resolution:window.devicePixelRatio||1,autoDensity:!0,antialias:!0}),document.querySelector("#canvas-container").appendChild(x.view);var d=async t=>{let{x:a,y:e,width:i,height:o,imgName:s,hitArea:n}=t;var c=s.split("-")[0];const d=new PIXI.Container;d.x=a+.5*i,d.y=e+.5*o,x.stage.addChild(d);var r,l,t=await PIXI.Assets.load(`./../assets/image/map${mapNum}/game/items/${s}.png`);const u=new PIXI.Sprite(t);u.anchor.set(.5),u.eventMode="static",u.cursor="pointer",void 0!==n&&0<n.length&&(r=-.5*i,l=-.5*o,p=n.map((t,a)=>a%2==0?t+r:t+l),u.hitArea=new PIXI.Polygon(p)),u.on("pointerdown",()=>{w&&(u.eventMode="none","coffee"!==c?(score[c]++,v++,$(`[data-item="${c}"]`).find("[data-num]").text(score[c]),m.play()):$(".game-stage").addClass("-coffee"),y===v&&setTimeout(()=>{I()},1e3),g.play())});var p=await PIXI.Assets.load(`./../assets/image/map${mapNum}/game/original/${s}.png`);const h=new PIXI.Sprite(p);h.anchor.set(.5),h.alpha=0,d.addChild(u),d.addChild(h);const m=gsap.timeline();if(m.pause(),"coffee"!==c){p=await PIXI.Assets.load("./../assets/image/other/add.png");const f=new PIXI.Sprite(p);f.x=a+.5*i-55,f.y=e-86,f.alpha=0,m.to(f,{alpha:1,duration:.3}).to(f,{alpha:0,duration:.3,delay:.3}),x.stage.addChild(f)}const g=gsap.timeline();g.pause(),g.to(d.scale,{x:1.3,y:1.3,duration:.5,ease:"back.out(4)"}).to(h,{alpha:1,duration:.5},"<").to(d,{alpha:0,duration:.3,delay:.2})},r=async t=>{var{x:a,y:e,width:i,height:o,imgName:t}=t,t=await PIXI.Assets.load(`./../assets/image/map${mapNum}/game/leaf/${t}.png`);const s=new PIXI.Sprite(t);s.anchor.set(1,1),s.x=a+i,s.y=e+o,s.eventMode="static",s.on("pointerdown",()=>{s.eventMode="none",n.play()}),x.stage.addChild(s);const n=gsap.timeline();n.pause(),n.to(s,{y:e+o-100,rotation:Math.PI/180*40,alpha:0,duration:.6})};function l(){var t=document.querySelector("#canvas-container").offsetWidth;x.stage.scale.set(t/1170)}fetch(`./../assets/image/map${mapNum}/game/data.json`).then(t=>t.json()).then(t=>{Object.entries(t.items).forEach(t=>{var[n,a]=t;const c=[1,2,3,4].sort(()=>Math.random()-.5).slice(0,s).map(t=>t-1);c.map(t=>a[t]).forEach((t,a)=>{const{x:e,y:i,width:o,height:s}=t;a=`${n}-${c[a]+1}`;if(d({x:e,y:i,width:o,height:s,imgName:a}),t.leaf){const{x:e,y:i,width:o,height:s}=t.leaf;r({x:e,y:i,width:o,height:s,imgName:a})}})});const{x:a,y:e,width:i,height:o}=t.coffee;if(d({x:a,y:e,width:i,height:o,imgName:"coffee"}),t.coffee.leaf){const{x:a,y:e,width:i,height:o}=t.coffee.leaf;r({x:a,y:e,width:i,height:o,imgName:"coffee"})}}),window.addEventListener("resize",()=>{l()}),l(),$("[data-step-btn]").on("click.step",function(){var t=$(this).data("stepBtn");switch($("[data-step]").removeClass("-active"),$(`[data-step="${t}"]`).addClass("-active"),t){case"task":e.play(),$(".main").hasClass("-f01")&&$(".header-subject").fadeOut(150,function(){$(".header-subject img").attr("src","./../assets/image/layout/subject-wt.png"),$(".header-subject").fadeIn(150)});break;case"instruction":$(".header-logo").addClass("-hide"),i.play(),o.play();break;case"game":setTimeout(()=>{null===c&&(w=!0,c=setInterval(()=>{n--,$("[data-second]").text(n),n<=0&&I()},1e3))},500);break;case"level":$(".header-subject img").attr("src","./../assets/image/layout/subject-dk.png"),$(".header-logo").removeClass("-hide")}})}();
//# sourceMappingURL=game.min.js.map
